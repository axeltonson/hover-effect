import{Scene as e,OrthographicCamera as t,WebGLRenderer as i,TextureLoader as n,RepeatWrapping as o,VideoTexture as a,LinearFilter as r,ShaderMaterial as s,PlaneBufferGeometry as d,Mesh as f}from"three";import l from"gsap/TweenMax";export default function(m){function v(){for(var e=arguments,t=0;t<arguments.length;t++)if(void 0!==e[t])return e[t]}console.log("%c Hover effect by Robin Delaporte: https://github.com/robin-dela/hover-effect ","color: #bada55; font-size: 0.8rem");var u=m.parent,g=m.displacementImage,c=m.image1,p=m.image2,h=v(m.intensity1,m.intensity,1),y=v(m.intensity2,m.intensity,1),x=v(m.angle,Math.PI/4),w=v(m.angle1,x),H=v(m.angle2,3*-x),P=v(m.speedIn,m.speed,1.6),W=v(m.speedOut,m.speed,1.2),F=v(m.hover,!0),D=v(m.easing,Expo.easeOut),E=v(m.video,!1);if(u)if(c&&p&&g){var b=new e,S=new t(u.offsetWidth/-2,u.offsetWidth/2,u.offsetHeight/2,u.offsetHeight/-2,1,1e3);S.position.z=1;var U=new i({antialias:!1,alpha:!0});U.setPixelRatio(window.devicePixelRatio),U.setClearColor(16777215,0),U.setSize(u.offsetWidth,u.offsetHeight),u.appendChild(U.domElement);var L=function(){U.render(b,S)},M=new n;M.crossOrigin="";var z=M.load(g,L);if(z.wrapS=z.wrapT=o,E){var C=function(){requestAnimationFrame(C),U.render(b,S)};C(),(E=document.createElement("video")).muted=!0,E.autoplay=!0,E.loop=!0,E.src=c,E.load();var R=document.createElement("video");R.muted=!0,R.autoplay=!0,R.loop=!0,R.src=p,R.load();var _=new a(E),T=new a(R);_.magFilter=T.magFilter=r,_.minFilter=T.minFilter=r,R.addEventListener("loadeddata",function(){R.play(),(T=new a(R)).magFilter=r,T.minFilter=r,I.uniforms.texture2.value=T},!1),E.addEventListener("loadeddata",function(){E.play(),(_=new a(E)).magFilter=r,_.minFilter=r,I.uniforms.texture1.value=_},!1)}else _=M.load(c,function(e){j(e,1)}),T=M.load(p,function(e){j(e,2)}),_.magFilter=T.magFilter=r,_.minFilter=T.minFilter=r;var I=new s({uniforms:{intensity1:{type:"f",value:h},intensity2:{type:"f",value:y},dispFactor:{type:"f",value:0},angle1:{type:"f",value:w},angle2:{type:"f",value:H},texture1:{type:"t",value:_},texture2:{type:"t",value:T},disp:{type:"t",value:z},canvasWidth:{type:"f",value:u.offsetWidth},canvasHeight:{type:"f",value:u.offsetHeight},image1Width:{type:"f",value:700},image1Height:{type:"f",value:700},image2Width:{type:"f",value:700},image2Height:{type:"f",value:700}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nvarying vec2 vUv;\nuniform float dispFactor;\nuniform sampler2D disp;\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\nuniform float canvasWidth;\nuniform float canvasHeight;\nuniform float image1Width;\nuniform float image1Height;\nuniform float image2Width;\nuniform float image2Height;\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n// Proportion script from here: https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\nvec2 addProportionToDistortedPosition(vec2 originalDistortedPos, float imgWidth, float imgHeight){\n  /* Set proportion code */\n  vec2 s = vec2(canvasWidth, canvasHeight); // Screen\n  vec2 i = vec2(imgWidth, imgHeight); // Image\n  float rs = s.x / s.y;\n  float ri = i.x / i.y;\n  vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n  vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n  return originalDistortedPos * s / new + offset;\n  /* End set proportion code */\n} \nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n  vec2 distortedPosition1 = vUv + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = vUv + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  distortedPosition1 = addProportionToDistortedPosition(distortedPosition1, image1Width, image1Height);\n  distortedPosition2 = addProportionToDistortedPosition(distortedPosition2, image2Width, image2Height);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n",transparent:!0,opacity:1}),O=new d(u.offsetWidth,u.offsetHeight,1),V=new f(O,I);b.add(V),F&&(u.addEventListener("mouseenter",q),u.addEventListener("touchstart",q),u.addEventListener("mouseleave",A),u.addEventListener("touchend",A)),window.addEventListener("resize",function(e){I.uniforms.canvasWidth.value=u.offsetWidth,I.uniforms.canvasHeight.value=u.offsetHeight,U.setSize(u.offsetWidth,u.offsetHeight),L()}),this.next=q,this.previous=A,U.setSize(u.offsetWidth,u.offsetHeight)}else console.warn("One or more images are missing");else console.warn("Parent missing");function j(e,t){var i=e.image.width,n=e.image.height;1==t?(I.uniforms.image1Width.value=i,I.uniforms.image1Height.value=n):(I.uniforms.image2Width.value=i,I.uniforms.image2Height.value=n),L()}function q(){l.to(I.uniforms.dispFactor,P,{value:1,ease:D,onUpdate:L,onComplete:L})}function A(){l.to(I.uniforms.dispFactor,W,{value:0,ease:D,onUpdate:L,onComplete:L})}}
//# sourceMappingURL=hover-effect.es.js.map
