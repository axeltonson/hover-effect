{"version":3,"file":"hover-effect.es.js","sources":["../src/hover-effect.js"],"sourcesContent":["import * as THREE from 'three';\r\nimport TweenMax from 'gsap/TweenMax';\r\n\r\nexport default function (opts) {\r\n\r\n  var vertex = `\r\nvarying vec2 vUv;\r\nvoid main() {\r\n  vUv = uv;\r\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n`;\r\n\r\n  var fragment = `\r\nvarying vec2 vUv;\r\n\r\nuniform float dispFactor;\r\nuniform float dpr;\r\nuniform sampler2D disp;\r\n\r\nuniform sampler2D texture1;\r\nuniform sampler2D texture2;\r\nuniform float angle1;\r\nuniform float angle2;\r\nuniform float intensity1;\r\nuniform float intensity2;\r\nuniform vec4 res;\r\nuniform vec2 parent;\r\n\r\nmat2 getRotM(float angle) {\r\n  float s = sin(angle);\r\n  float c = cos(angle);\r\n  return mat2(c, -s, s, c);\r\n}\r\n\r\nvoid main() {\r\n  vec4 disp = texture2D(disp, vUv);\r\n  vec2 dispVec = vec2(disp.r, disp.g);\r\n\r\n  vec2 uv = 0.5 * gl_FragCoord.xy / (res.xy) ;\r\n  vec2 myUV = (uv - vec2(0.5))*res.zw + vec2(0.5);\r\n\r\n\r\n  vec2 distortedPosition1 = myUV + getRotM(angle1) * dispVec * intensity1 * dispFactor;\r\n  vec2 distortedPosition2 = myUV + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\r\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\r\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\r\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\r\n}\r\n`;\r\n\r\n  // please respect authorship and do not remove\r\n  console.log('%c Hover effect by Robin Delaporte: https://github.com/robin-dela/hover-effect ', 'color: #bada55; font-size: 0.8rem');\r\n\r\n\r\n  function firstDefined() {\r\n    for (var i = 0; i < arguments.length; i++) {\r\n      if (arguments[i] !== undefined) return arguments[i];\r\n    }\r\n  }\r\n\r\n  var parent = opts.parent;\r\n  var dispImage = opts.displacementImage;\r\n  var image1 = opts.image1;\r\n  var image2 = opts.image2;\r\n  var imagesRatio = firstDefined(opts.imagesRatio, 1.0);\r\n  var intensity1 = firstDefined(opts.intensity1, opts.intensity, 1);\r\n  var intensity2 = firstDefined(opts.intensity2, opts.intensity, 1);\r\n  var commonAngle = firstDefined(opts.angle, Math.PI / 4); // 45 degrees by default, so grayscale images work correctly\r\n  var angle1 = firstDefined(opts.angle1, commonAngle);\r\n  var angle2 = firstDefined(opts.angle2, -commonAngle * 3);\r\n  var speedIn = firstDefined(opts.speedIn, opts.speed, 1.6);\r\n  var speedOut = firstDefined(opts.speedOut, opts.speed, 1.2);\r\n  var userHover = firstDefined(opts.hover, true);\r\n  var easing = firstDefined(opts.easing, Expo.easeOut);\r\n  var video = firstDefined(opts.video, false);\r\n\r\n  if (!parent) {\r\n    console.warn('Parent missing');\r\n    return;\r\n  }\r\n\r\n  if (!(image1 && image2 && dispImage)) {\r\n    console.warn('One or more images are missing');\r\n    return;\r\n  }\r\n\r\n  var scene = new THREE.Scene();\r\n  var camera = new THREE.OrthographicCamera(\r\n    parent.offsetWidth / -2,\r\n    parent.offsetWidth / 2,\r\n    parent.offsetHeight / 2,\r\n    parent.offsetHeight / -2,\r\n    1,\r\n    1000\r\n  );\r\n\r\n  camera.position.z = 1;\r\n\r\n  var renderer = new THREE.WebGLRenderer({\r\n    antialias: false,\r\n    alpha: true\r\n  });\r\n\r\n  renderer.setPixelRatio(2.0);\r\n  renderer.setClearColor(0xffffff, 0.0);\r\n  renderer.setSize(parent.offsetWidth, parent.offsetHeight);\r\n  parent.appendChild(renderer.domElement);\r\n\r\n  var render = function () {\r\n    // This will be called by the TextureLoader as well as TweenMax.\r\n    renderer.render(scene, camera);\r\n  };\r\n\r\n  var loader = new THREE.TextureLoader();\r\n  loader.crossOrigin = '';\r\n\r\n  var disp = loader.load(dispImage, render);\r\n  disp.magFilter = disp.minFilter = THREE.LinearFilter;\r\n\r\n  if (video) {\r\n    var animate = function() {\r\n        requestAnimationFrame(animate);\r\n\r\n        renderer.render(scene, camera);\r\n    };\r\n    animate();\r\n\r\n    var video = document.createElement('video');\r\n    video.muted = true;\r\n    video.autoplay = true;\r\n    video.loop = true;\r\n    video.src = image1;\r\n    video.load();\r\n\r\n    var video2 = document.createElement('video');\r\n    video2.muted = true;\r\n    video2.autoplay = true;\r\n    video2.loop = true;\r\n    video2.src = image2;\r\n    video2.load();\r\n\r\n    var texture1 = new THREE.VideoTexture(video);\r\n    var texture2 = new THREE.VideoTexture(video2);\r\n    texture1.magFilter = texture2.magFilter = THREE.LinearFilter;\r\n    texture1.minFilter = texture2.minFilter = THREE.LinearFilter;\r\n\r\n    video2.addEventListener('loadeddata', function() {\r\n      video2.play();\r\n\r\n      texture2 = new THREE.VideoTexture(video2);\r\n      texture2.magFilter = THREE.LinearFilter;\r\n      texture2.minFilter = THREE.LinearFilter;\r\n\r\n      mat.uniforms.texture2.value = texture2;\r\n\r\n    }, false);\r\n\r\n    video.addEventListener('loadeddata', function() {\r\n      video.play();\r\n\r\n      texture1 = new THREE.VideoTexture(video);\r\n\r\n      texture1.magFilter = THREE.LinearFilter;\r\n      texture1.minFilter = THREE.LinearFilter;\r\n\r\n      mat.uniforms.texture1.value = texture1;\r\n    }, false);\r\n  } else {\r\n    var texture1 = loader.load(image1, render);\r\n    var texture2 = loader.load(image2, render);\r\n\r\n    texture1.magFilter = texture2.magFilter = THREE.LinearFilter;\r\n    texture1.minFilter = texture2.minFilter = THREE.LinearFilter;\r\n  }\r\n\r\n  let a1, a2;\r\n  var imageAspect = imagesRatio;\r\n  if (parent.offsetHeight / parent.offsetWidth < imageAspect) {\r\n    a1 = 1;\r\n    a2 = parent.offsetHeight / parent.offsetWidth / imageAspect;\r\n  } else {\r\n    a1 = (parent.offsetWidth / parent.offsetHeight) * imageAspect;\r\n    a2 = 1;\r\n  }\r\n\r\n  var mat = new THREE.ShaderMaterial({\r\n    uniforms: {\r\n      intensity1: {\r\n        type: 'f',\r\n        value: intensity1\r\n      },\r\n      intensity2: {\r\n        type: 'f',\r\n        value: intensity2\r\n      },\r\n      dispFactor: {\r\n        type: 'f',\r\n        value: 0.0\r\n      },\r\n      angle1: {\r\n        type: 'f',\r\n        value: angle1\r\n      },\r\n      angle2: {\r\n        type: 'f',\r\n        value: angle2\r\n      },\r\n      texture1: {\r\n        type: 't',\r\n        value: texture1\r\n      },\r\n      texture2: {\r\n        type: 't',\r\n        value: texture2\r\n      },\r\n      disp: {\r\n        type: 't',\r\n        value: disp\r\n      },\r\n      res: {\r\n        type: 'vec4',\r\n        value: new THREE.Vector4(parent.offsetWidth, parent.offsetHeight, a1, a2)\r\n      },\r\n      dpr: {\r\n        type: 'f',\r\n        value: window.devicePixelRatio\r\n      }\r\n    },\r\n\r\n    vertexShader: vertex,\r\n    fragmentShader: fragment,\r\n    transparent: true,\r\n    opacity: 1.0,\r\n  });\r\n\r\n  var geometry = new THREE.PlaneBufferGeometry(parent.offsetWidth, parent.offsetHeight, 1);\r\n  var object = new THREE.Mesh(geometry, mat);\r\n  scene.add(object);\r\n\r\n  function transitionIn() {\r\n    TweenMax.to(mat.uniforms.dispFactor, speedIn, {\r\n      value: 1,\r\n      ease: easing,\r\n      onUpdate: render,\r\n      onComplete: render,\r\n    });\r\n  }\r\n\r\n  function transitionOut() {\r\n    TweenMax.to(mat.uniforms.dispFactor, speedOut, {\r\n      value: 0,\r\n      ease: easing,\r\n      onUpdate: render,\r\n      onComplete: render,\r\n    });\r\n  }\r\n\r\n  if (userHover) {\r\n    parent.addEventListener('mouseenter', transitionIn);\r\n    parent.addEventListener('touchstart', transitionIn);\r\n    parent.addEventListener('mouseleave', transitionOut);\r\n    parent.addEventListener('touchend', transitionOut);\r\n  }\r\n\r\n  window.addEventListener('resize', function (e) {\r\n    if (parent.offsetHeight / parent.offsetWidth < imageAspect) {\r\n      a1 = 1;\r\n      a2 = parent.offsetHeight / parent.offsetWidth / imageAspect;\r\n    } else {\r\n      a1 = (parent.offsetWidth / parent.offsetHeight) * imageAspect;\r\n      a2 = 1;\r\n    }\r\n    object.material.uniforms.res.value = new THREE.Vector4(parent.offsetWidth, parent.offsetHeight, a1, a2);\r\n    renderer.setSize(parent.offsetWidth, parent.offsetHeight);\r\n\r\n    render()\r\n  });\r\n\r\n  this.next = transitionIn;\r\n  this.previous = transitionOut;\r\n};\r\n"],"names":["opts","firstDefined","i","arguments","length","undefined","console","log","parent","dispImage","displacementImage","image1","image2","imagesRatio","intensity1","intensity","intensity2","commonAngle","angle","Math","PI","angle1","angle2","speedIn","speed","speedOut","userHover","hover","easing","Expo","easeOut","video","scene","THREE","camera","offsetWidth","offsetHeight","position","z","renderer","antialias","alpha","setPixelRatio","setClearColor","setSize","appendChild","domElement","render","loader","crossOrigin","a1","a2","disp","load","magFilter","minFilter","animate","requestAnimationFrame","document","createElement","muted","autoplay","loop","src","video2","texture1","texture2","addEventListener","play","mat","uniforms","value","imageAspect","type","dispFactor","res","dpr","window","devicePixelRatio","vertexShader","fragmentShader","transparent","opacity","geometry","object","add","transitionIn","transitionOut","e","material","next","previous","warn","TweenMax","to","ease","onUpdate","onComplete"],"mappings":"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"}